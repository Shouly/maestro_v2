# Maestro 技术栈文档

## 概述

Maestro是一个使用Tauri和Rust构建的跨平台桌面应用，通过Claude AI模型控制计算机执行各种任务。本文档详细描述了项目的技术栈选择、架构设计和开发工具链。

## 核心技术栈

### 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| **Next.js** | v15 | React框架，提供路由、服务端渲染和优化 |
| **React** | v18+ | 用户界面库，构建交互式UI组件 |
| **Tailwind CSS** | v3.4+ | 实用优先的CSS框架，快速构建自定义设计 |
| **shadcn/ui** | 最新版 | 基于Radix UI的高质量组件库，提供可访问性和可定制性 |
| **Lucide React** | 最新版 | 简洁一致的图标库 |
| **Framer Motion** | v11+ | 强大的动画库，提供流畅的过渡效果 |
| **Bun** | v1.0+ | JavaScript运行时和包管理器 |

### 后端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| **Tauri** | 2.0 | 跨平台桌面应用框架，连接Web前端和Rust后端 |
| **Rust** | 2021 Edition | 系统编程语言，提供安全性和性能 |
| **tokio** | 最新版 | 异步运行时，处理并发操作 |
| **screenshots** | 最新版 | 屏幕捕获库 |
| **enigo** | 最新版 | 键盘和鼠标控制库 |
| **reqwest** | 最新版 | HTTP客户端，与Anthropic API通信 |
| **serde** | 最新版 | 序列化和反序列化库 |
| **rusqlite/sqlx** | 最新版 | SQLite数据库连接库 |

## 详细技术说明

### 1. 前端技术

#### 1.1 Next.js (v15)

Next.js是一个基于React的全栈框架，为Maestro提供以下功能：

- **App Router**：使用基于文件系统的路由
- **服务器组件**：减少客户端JavaScript体积
- **布局系统**：实现一致的UI布局
- **优化**：自动图像、字体和脚本优化
- **开发工具**：热重载和错误报告

#### 1.2 React (v18+)

React是前端的核心库，负责：

- **组件化开发**：构建可复用的UI组件
- **状态管理**：使用React Context API和Hooks管理状态
- **生命周期管理**：处理组件的挂载、更新和卸载
- **虚拟DOM**：高效更新UI

#### 1.3 Tailwind CSS (v3.4+)

Tailwind CSS是一个实用优先的CSS框架，提供：

- **原子类**：使用预定义的工具类快速构建UI
- **响应式设计**：内置断点系统适应不同屏幕尺寸
- **暗色模式**：支持深色/浅色主题切换
- **JIT编译**：按需生成CSS，减小文件体积

#### 1.4 shadcn/ui

shadcn/ui是一个基于Radix UI的组件集合，提供：

- **可访问性**：符合WCAG标准的组件
- **可定制性**：组件可以根据项目需求定制
- **主题系统**：支持深色/浅色模式和自定义主题
- **无运行时**：组件直接复制到项目中，无额外依赖

#### 1.5 Lucide React

Lucide React是一个图标库，提供：

- **一致的设计语言**：统一的图标风格
- **可定制性**：支持颜色、大小和其他属性的自定义
- **轻量级**：按需导入，减小包体积

#### 1.6 Framer Motion (v11+)

Framer Motion是一个React动画库，提供：

- **声明式API**：简化动画创建
- **手势支持**：处理拖拽、点击等交互
- **过渡效果**：平滑的元素过渡
- **动画序列**：协调多个元素的动画

#### 1.7 Bun (v1.0+)

Bun是一个现代JavaScript运行时、包管理器和构建工具，为Maestro项目提供以下优势：

- **高性能**：比Node.js和npm更快的包安装和脚本执行
- **全功能**：集成了运行时、包管理器、测试运行器和构建工具
- **兼容性**：与npm生态系统兼容，可以使用现有的npm包
- **内置优化**：内置了许多优化，如压缩、转译和打包
- **TypeScript支持**：原生支持TypeScript，无需额外配置
- **开发体验**：提供更快的热重载和开发服务器

在Maestro项目中，Bun用于：

- 管理前端依赖
- 运行开发服务器
- 执行构建脚本
- 运行测试
- 与Tauri集成，简化开发工作流

### 2. 后端技术

#### 2.1 Tauri (2.0)

Tauri是一个构建跨平台桌面应用的框架，提供：

- **轻量级**：比Electron更小的二进制文件和内存占用
- **安全性**：细粒度的权限系统
- **性能**：使用系统WebView而非捆绑Chromium
- **IPC系统**：前端和Rust后端之间的通信
- **插件系统**：扩展核心功能

#### 2.2 Rust (2021 Edition)

Rust是一种系统编程语言，提供：

- **内存安全**：无需垃圾收集器的内存管理
- **并发安全**：编译时防止数据竞争
- **性能**：接近C/C++的执行效率
- **跨平台**：支持多种操作系统和架构

#### 2.3 核心Rust库

- **tokio**：异步运行时，处理并发操作
- **screenshots**：屏幕捕获功能
- **enigo**：模拟键盘和鼠标输入
- **reqwest**：HTTP客户端，与API通信
- **serde**：序列化和反序列化JSON数据
- **thiserror/anyhow**：错误处理
- **rusqlite/sqlx**：SQLite数据库交互

### 3. 开发工具链

#### 3.1 构建工具

- **Rust Cargo**：Rust包管理和构建系统
- **Bun**：JavaScript运行时、包管理器和构建工具
- **Tauri CLI**：Tauri应用构建和打包

#### 3.1.1 Bun

Bun是一个现代JavaScript运行时、包管理器和构建工具，为Maestro项目提供以下优势：

- **高性能**：比Node.js和npm更快的包安装和脚本执行
- **全功能**：集成了运行时、包管理器、测试运行器和构建工具
- **兼容性**：与npm生态系统兼容，可以使用现有的npm包
- **内置优化**：内置了许多优化，如压缩、转译和打包
- **TypeScript支持**：原生支持TypeScript，无需额外配置
- **开发体验**：提供更快的热重载和开发服务器

在Maestro项目中，Bun用于：

- 管理前端依赖
- 运行开发服务器
- 执行构建脚本
- 运行测试
- 与Tauri集成，简化开发工作流

#### 3.2 开发环境

- **VS Code/Cursor**：推荐的IDE，支持Rust和TypeScript
- **Rust Analyzer**：Rust语言服务器
- **ESLint**：JavaScript/TypeScript代码检查
- **Prettier**：代码格式化
- **Tailwind CSS IntelliSense**：Tailwind类自动完成
- **Bun插件**：VS Code/Cursor的Bun支持插件

#### 3.3 测试工具

- **Bun Test**：使用Bun内置的测试运行器
- **Rust Test**：Rust单元测试
- **Playwright**：端到端测试
- **Tauri Testing**：Tauri应用测试

## 架构设计

### 1. 前后端通信

Maestro使用Tauri的IPC机制实现前端和Rust后端的通信：

```
┌─────────────────┐      ┌─────────────────┐
│                 │      │                 │
│  Next.js/React  │◄────►│  Tauri/Rust     │
│  (前端)          │ IPC  │  (后端)         │
│                 │      │                 │
└─────────────────┘      └─────────────────┘
```

- **命令系统**：前端调用Rust函数
- **事件系统**：后端向前端发送事件
- **状态同步**：保持前后端状态一致

### 2. 模块化设计

Maestro采用模块化设计，将功能分为以下核心模块：

#### 前端模块

- **UI组件**：可复用的界面元素
- **状态管理**：全局应用状态
- **API客户端**：与Anthropic API通信
- **工具界面**：工具执行结果展示

#### 后端模块

- **ComputerTool**：屏幕、键盘和鼠标控制
- **BashTool**：命令行执行
- **EditTool**：文件编辑
- **API客户端**：与Anthropic API通信
- **数据存储**：配置和会话管理

### 3. 数据流

```
┌──────────┐    ┌───────────┐    ┌───────────┐    ┌──────────┐
│          │    │           │    │           │    │          │
│  用户界面 │───►│ Rust后端  │───►│ Claude API │───►│ 工具执行 │
│          │    │           │    │           │    │          │
└──────────┘    └───────────┘    └───────────┘    └──────────┘
     ▲                                                 │
     └─────────────────────────────────────────────────┘
```

## 跨平台支持

Maestro支持以下操作系统：

- **Windows 10+**
- **macOS 10.15+**
- **Ubuntu 20.04+**

每个平台的特定实现：

### Windows

- 使用Windows API进行屏幕捕获和输入模拟
- 使用PowerShell/CMD执行命令
- 支持Windows特定的键盘快捷键

### macOS

- 使用macOS API进行屏幕捕获和输入模拟
- 使用Bash/Zsh执行命令
- 支持macOS特定的键盘快捷键

### Linux

- 使用X11/Wayland API进行屏幕捕获和输入模拟
- 使用Bash执行命令
- 支持Linux特定的键盘快捷键

## 安全考虑

Maestro实现了以下安全措施：

- **权限控制**：细粒度的系统权限控制
- **API密钥保护**：安全存储API密钥
- **沙箱执行**：工具在受限环境中执行
- **数据加密**：本地数据加密存储

## 性能优化

为确保应用性能，Maestro实现了以下优化：

- **懒加载**：按需加载组件和资源
- **资源缓存**：缓存API响应和频繁使用的资源
- **并发处理**：使用tokio异步运行时处理并发任务
- **内存管理**：优化内存使用，避免泄漏

## 开发最佳实践

### 代码风格

- **Rust**：遵循Rust官方风格指南
- **TypeScript**：使用严格模式和ESLint规则
- **组件**：采用原子设计模式组织UI组件

### 版本控制

- **Git Flow**：使用Git Flow工作流
- **语义化版本**：遵循SemVer规范
- **提交消息**：使用约定式提交规范

### 文档

- **代码注释**：使用文档注释
- **API文档**：使用Rustdoc和JSDoc
- **用户文档**：提供详细的用户指南

## 结论

Maestro的技术栈选择基于以下考虑：

1. **性能**：Rust和Tauri提供卓越的性能和资源效率
2. **用户体验**：Next.js、React和shadcn/ui提供现代化的用户界面
3. **可维护性**：模块化设计和清晰的架构便于维护和扩展
4. **跨平台**：支持主流桌面操作系统

这些技术的组合使Maestro能够提供高性能、跨平台的AI驱动计算机控制体验，同时保持代码的可维护性和可扩展性。 